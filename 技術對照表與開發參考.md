# è¨‚å–®ç®¡ç†ç³»çµ± - æŠ€è¡“å°ç…§è¡¨èˆ‡é–‹ç™¼åƒè€ƒ

## ğŸ“‹ æ–‡ä»¶ç›®çš„

æœ¬æ–‡ä»¶æä¾›å¤–éƒ¨ç³»çµ±é–‹ç™¼äººå“¡è©³ç´°çš„æŠ€è¡“åƒè€ƒè³‡æ–™ï¼Œç¢ºä¿ç”Ÿæˆçš„ Excel æª”æ¡ˆèƒ½è¢«è¨‚å–®ç®¡ç†ç³»çµ±æ­£ç¢ºåŒ¯å…¥ã€‚

---

## ğŸ¯ æ¬„ä½æŠ€è¡“å°ç…§è¡¨

### å®Œæ•´æ¬„ä½å°ç…§ (A-N æ¬„ï¼Œå…± 14 æ¬„)

| Excel æ¬„ä½ | æ¬„ä½ç´¢å¼• | ä¸­æ–‡åç¨± | è‹±æ–‡æ¬„ä½å | è³‡æ–™å‹åˆ¥ | é©—è­‰è¦å‰‡ | é è¨­å€¼ | èªªæ˜ |
|------------|---------|----------|-----------|---------|----------|---------|------|
| **A** | `row[0]` | è¨‚å–®ç·¨è™Ÿ | `order_code` | string | required, unique | - | ç³»çµ±å”¯ä¸€è­˜åˆ¥ç¢¼ |
| **B** | `row[1]` | å§“å | `name` | string | required | - | ä¹˜å®¢å§“å |
| **C** | `row[2]` | é›»è©± | `phone` | string | required | - | è¯çµ¡é›»è©± |
| **D** | `row[3]` | ç·¨è™Ÿ | `unit_number` | string | required | - | å…§éƒ¨ç·¨è™Ÿæˆ–æ¡ˆè™Ÿ |
| **E** | `row[4]` | é¡å‹ | `type` | string | required | - | è¨‚å–®é¡å‹åˆ†é¡ |
| **F** | `row[5]` | æ—¥æœŸ | `date` | date | required | - | è»Šè¶Ÿæ—¥æœŸï¼Œæ”¯æ´å¤šç¨®æ ¼å¼ |
| **G** | `row[6]` | æ™‚é–“ | `time` | time | required | - | è»Šè¶Ÿæ™‚é–“ HH:MM |
| **H** | `row[7]` | ä¸Šè»Šå€ | `origin_area` | string | required | - | ä¸Šè»Šå€åŸŸ |
| **I** | `row[8]` | ä¸Šè»Šåœ°å€ | `origin_address` | string | required | - | è©³ç´°ä¸Šè»Šåœ°å€ |
| **J** | `row[9]` | ä¸‹è»Šå€ | `dest_area` | string | required | - | ä¸‹è»Šå€åŸŸ |
| **K** | `row[10]` | ä¸‹è»Šåœ°å€ | `dest_address` | string | required | - | è©³ç´°ä¸‹è»Šåœ°å€ |
| **L** | `row[11]` | å‚™è¨» | `remark` | string | nullable | `''` | é¡å¤–èªªæ˜ |
| **M** | `row[12]` | éšŠå“¡ç·¨è™Ÿ | `assigned_user_id` | string | nullable, max:255 | `null` | é§•é§›å“¡ç·¨è™Ÿ |
| **N** | `row[13]` | ç‰¹æ®Šç‹€æ…‹ | `special_status` | string | nullable | `null` | ç‰¹æ®Šæ¨™è¨˜ |

---

## ğŸ”§ Laravel é©—è­‰è¦å‰‡å°æ‡‰

### ç³»çµ±å…§éƒ¨é©—è­‰é‚è¼¯

```php
// OrderController.php çš„é©—è­‰è¦å‰‡
$validator = Validator::make([
    'order_code' => $row[0] ?? null,           // A æ¬„ï¼šè¨‚å–®ç·¨è™Ÿ
    'name' => $row[1] ?? null,                 // B æ¬„ï¼šå§“å
    'phone' => $row[2] ?? null,                // C æ¬„ï¼šé›»è©±
    'unit_number' => $row[3] ?? null,          // D æ¬„ï¼šç·¨è™Ÿ
    'type' => $row[4] ?? null,                 // E æ¬„ï¼šé¡å‹
    'date' => $date,                           // F æ¬„ï¼šæ—¥æœŸ (ç¶“éè½‰æ›)
    'time' => $row[6] ?? null,                 // G æ¬„ï¼šæ™‚é–“
    'origin_area' => $row[7] ?? null,          // H æ¬„ï¼šä¸Šè»Šå€
    'origin_address' => $row[8] ?? null,       // I æ¬„ï¼šä¸Šè»Šåœ°å€
    'dest_area' => $row[9] ?? null,            // J æ¬„ï¼šä¸‹è»Šå€
    'dest_address' => $row[10] ?? null,        // K æ¬„ï¼šä¸‹è»Šåœ°å€
    'remark' => $row[11] ?? '',                // L æ¬„ï¼šå‚™è¨»
    'assigned_user_id' => $row[12],            // M æ¬„ï¼šéšŠå“¡ç·¨è™Ÿ
    'special_status' => $row[13] ?? null,      // N æ¬„ï¼šç‰¹æ®Šç‹€æ…‹
], [
    'order_code' => 'required|string|unique:orders,order_code',
    'name' => 'required|string',
    'phone' => 'required|string',
    'unit_number' => 'required|string',
    'type' => 'required|string',
    'date' => 'required|date',
    'time' => 'required',
    'origin_area' => 'required|string',
    'origin_address' => 'required|string',
    'dest_area' => 'required|string',
    'dest_address' => 'required|string',
    'assigned_user_id' => 'nullable|string|max:255',
    'special_status' => 'nullable|string',
]);
```

---

## ğŸ“… æ—¥æœŸè½‰æ›é‚è¼¯

### ç³»çµ±æ”¯æ´çš„æ—¥æœŸæ ¼å¼è™•ç†

ç³»çµ±ä½¿ç”¨å…©å±¤æ—¥æœŸè½‰æ›é‚è¼¯ï¼š

```php
// ç¬¬ä¸€å±¤ï¼šExcel æ•¸å­—æ—¥æœŸè½‰æ›
if (is_numeric($rawDate)) {
    try {
        $date = ExcelDate::excelToDateTimeObject($rawDate)->format('Y-m-d');
    } catch (\Exception $e) {
        $date = null;
    }
}

// ç¬¬äºŒå±¤ï¼šæ–‡å­—æ—¥æœŸè½‰æ›
elseif (!empty($rawDate)) {
    try {
        $date = Carbon::parse($rawDate)->format('Y-m-d');
    } catch (\Exception $e) {
        $date = null;
    }
}
```

### å¤–éƒ¨ç³»çµ±å»ºè­°å¯¦ä½œ

```php
// PHP ç¯„ä¾‹ï¼šç”Ÿæˆç›¸å®¹çš„æ—¥æœŸæ ¼å¼
function formatDateForImport($date) {
    // æ–¹æ³• 1ï¼šä½¿ç”¨ Excel æ•¸å­—æ ¼å¼ï¼ˆæ¨è–¦ï¼‰
    return \PhpOffice\PhpSpreadsheet\Shared\Date::PHPToExcel($date);
    
    // æ–¹æ³• 2ï¼šä½¿ç”¨ ISO å­—ä¸²æ ¼å¼
    return date('Y-m-d', strtotime($date));
}
```

---

## âš¡ ç‹€æ…‹è‡ªå‹•åˆ¤å®šé‚è¼¯

### ç³»çµ±å…§å»ºç‹€æ…‹è¨­å®šè¦å‰‡

```php
// æ ¹æ“šéšŠå“¡ç·¨è™Ÿè‡ªå‹•åˆ¤å®šè¨‚å–®ç‹€æ…‹
'status' => !empty($row[12]) ? 'assigned' : 'open',
'assigned_user_id' => $row[12] ?? null,
```

### ç‹€æ…‹å°æ‡‰è¡¨

| éšŠå“¡ç·¨è™Ÿæ¬„ä½å€¼ | ç³»çµ±è¨­å®šç‹€æ…‹ | ä¸­æ–‡é¡¯ç¤º |
|---------------|-------------|----------|
| æœ‰å€¼ (å¦‚ï¼š"D001") | `assigned` | å·²æŒ‡æ´¾ |
| ç©ºå€¼æˆ– null | `open` | å¾…æ¢å–® |

---

## ğŸ—‚ï¸ è³‡æ–™åº«æ¬„ä½å°æ‡‰

### Orders è³‡æ–™è¡¨æ¬„ä½çµæ§‹

```sql
-- åŸºæ–¼ orders è³‡æ–™è¡¨çµæ§‹çš„æ¬„ä½å°æ‡‰
CREATE TABLE `orders` (
    `id` bigint(20) unsigned NOT NULL AUTO_INCREMENT,
    `order_code` varchar(255) NOT NULL,      -- Excel A æ¬„
    `date` date NOT NULL,                    -- Excel F æ¬„
    `time` time NOT NULL,                    -- Excel G æ¬„
    `origin_area` varchar(255) NOT NULL,     -- Excel H æ¬„
    `origin_address` varchar(255) NOT NULL,  -- Excel I æ¬„
    `dest_area` varchar(255) NOT NULL,       -- Excel J æ¬„
    `dest_address` varchar(255) NOT NULL,    -- Excel K æ¬„
    `remark` text,                           -- Excel L æ¬„
    `assigned_user_id` bigint(20) unsigned, -- Excel M æ¬„
    `status` enum('open','assigned','completed') DEFAULT 'open',
    `created_at` timestamp NULL DEFAULT NULL,
    `updated_at` timestamp NULL DEFAULT NULL,
    UNIQUE KEY `orders_order_code_unique` (`order_code`)
);
```

### æ“´å±•æ¬„ä½ (Model å±¤æ–°å¢)

```php
// Order.php Model çš„ fillable å±¬æ€§
protected $fillable = [
    'name',                  // Excel B æ¬„ - é€é Model å±¤è™•ç†
    'phone',                 // Excel C æ¬„ - é€é Model å±¤è™•ç†
    'unit_number',           // Excel D æ¬„ - é€é Model å±¤è™•ç†
    'type',                  // Excel E æ¬„ - é€é Model å±¤è™•ç†
    'special_status',        // Excel N æ¬„ - é€é Model å±¤è™•ç†
    // ... å…¶ä»–æ¬„ä½
];
```

---

## ğŸ’» å®Œæ•´ç¨‹å¼ç¢¼ç¯„ä¾‹

### PHP + PhpSpreadsheet ç¯„ä¾‹

```php
<?php
use PhpOffice\PhpSpreadsheet\Spreadsheet;
use PhpOffice\PhpSpreadsheet\Writer\Xlsx;

function generateOrdersExcel($orders, $filename = 'è¨‚å–®åŒ¯å…¥.xlsx') {
    $spreadsheet = new Spreadsheet();
    $sheet = $spreadsheet->getActiveSheet();
    
    // è¨­å®šæ¨™é¡Œåˆ—ï¼ˆç¬¬1è¡Œï¼‰
    $headers = [
        'A1' => 'è¨‚å–®ç·¨è™Ÿ',    // row[0]
        'B1' => 'å§“å',        // row[1]
        'C1' => 'é›»è©±',        // row[2]
        'D1' => 'ç·¨è™Ÿ',        // row[3]
        'E1' => 'é¡å‹',        // row[4]
        'F1' => 'æ—¥æœŸ',        // row[5]
        'G1' => 'æ™‚é–“',        // row[6]
        'H1' => 'ä¸Šè»Šå€',      // row[7]
        'I1' => 'ä¸Šè»Šåœ°å€',    // row[8]
        'J1' => 'ä¸‹è»Šå€',      // row[9]
        'K1' => 'ä¸‹è»Šåœ°å€',    // row[10]
        'L1' => 'å‚™è¨»',        // row[11]
        'M1' => 'éšŠå“¡ç·¨è™Ÿ',    // row[12]
        'N1' => 'ç‰¹æ®Šç‹€æ…‹'     // row[13]
    ];
    
    foreach ($headers as $cell => $value) {
        $sheet->setCellValue($cell, $value);
    }
    
    // å¡«å…¥è³‡æ–™ï¼ˆå¾ç¬¬2è¡Œé–‹å§‹ï¼‰
    $row = 2;
    foreach ($orders as $order) {
        $sheet->setCellValue("A{$row}", $order['order_code']);
        $sheet->setCellValue("B{$row}", $order['name']);
        $sheet->setCellValue("C{$row}", $order['phone']);
        $sheet->setCellValue("D{$row}", $order['unit_number']);
        $sheet->setCellValue("E{$row}", $order['type']);
        
        // æ—¥æœŸæ ¼å¼åŒ– - é‡è¦ï¼
        $sheet->setCellValue("F{$row}", $order['date']); // YYYY-MM-DD
        
        // æ™‚é–“æ ¼å¼åŒ– - é‡è¦ï¼
        $timeFormatted = date('H:i', strtotime($order['time']));
        $sheet->setCellValue("G{$row}", $timeFormatted);
        
        $sheet->setCellValue("H{$row}", $order['origin_area']);
        $sheet->setCellValue("I{$row}", $order['origin_address']);
        $sheet->setCellValue("J{$row}", $order['dest_area']);
        $sheet->setCellValue("K{$row}", $order['dest_address']);
        $sheet->setCellValue("L{$row}", $order['remark'] ?? '');
        $sheet->setCellValue("M{$row}", $order['assigned_user_id'] ?? '');
        $sheet->setCellValue("N{$row}", $order['special_status'] ?? '');
        
        $row++;
    }
    
    // å„²å­˜æª”æ¡ˆ
    $writer = new Xlsx($spreadsheet);
    $writer->save($filename);
    
    return $filename;
}

// ä½¿ç”¨ç¯„ä¾‹
$orders = [
    [
        'order_code' => 'ORD20250824001',
        'name' => 'ç‹å°æ˜',
        'phone' => '0912345678',
        'unit_number' => 'A001',
        'type' => 'æ–°åŒ—é•·ç…§',
        'date' => '2025-08-24',
        'time' => '14:30:00',
        'origin_area' => 'æ¿æ©‹å€',
        'origin_address' => 'æ°‘æ—è·¯100è™Ÿ',
        'dest_area' => 'æ–°èŠå€',
        'dest_address' => 'ä¸­æ­£è·¯200è™Ÿ',
        'remark' => 'è¼ªæ¤…ä¹˜å®¢',
        'assigned_user_id' => '',        // ç©ºå€¼ = å¾…æ¶å–®
        'special_status' => 'å„ªå…ˆ'
    ]
];

$filename = generateOrdersExcel($orders);
echo "Excel æª”æ¡ˆå·²ç”Ÿæˆï¼š{$filename}";
```

### Node.js + ExcelJS ç¯„ä¾‹

```javascript
const ExcelJS = require('exceljs');

async function generateOrdersExcel(orders, filename = 'è¨‚å–®åŒ¯å…¥.xlsx') {
    const workbook = new ExcelJS.Workbook();
    const worksheet = workbook.addWorksheet('è¨‚å–®è³‡æ–™');
    
    // è¨­å®šæ¨™é¡Œåˆ—
    const headers = [
        'è¨‚å–®ç·¨è™Ÿ', 'å§“å', 'é›»è©±', 'ç·¨è™Ÿ', 'é¡å‹', 'æ—¥æœŸ', 'æ™‚é–“',
        'ä¸Šè»Šå€', 'ä¸Šè»Šåœ°å€', 'ä¸‹è»Šå€', 'ä¸‹è»Šåœ°å€', 'å‚™è¨»', 'éšŠå“¡ç·¨è™Ÿ', 'ç‰¹æ®Šç‹€æ…‹'
    ];
    
    worksheet.addRow(headers);
    
    // æ–°å¢è³‡æ–™åˆ—
    orders.forEach(order => {
        worksheet.addRow([
            order.order_code,           // A æ¬„ row[0]
            order.name,                 // B æ¬„ row[1]
            order.phone,                // C æ¬„ row[2]
            order.unit_number,          // D æ¬„ row[3]
            order.type,                 // E æ¬„ row[4]
            order.date,                 // F æ¬„ row[5] - YYYY-MM-DD
            order.time.substring(0, 5), // G æ¬„ row[6] - HH:MM
            order.origin_area,          // H æ¬„ row[7]
            order.origin_address,       // I æ¬„ row[8]
            order.dest_area,            // J æ¬„ row[9]
            order.dest_address,         // K æ¬„ row[10]
            order.remark || '',         // L æ¬„ row[11]
            order.assigned_user_id || '', // M æ¬„ row[12]
            order.special_status || ''  // N æ¬„ row[13]
        ]);
    });
    
    // å„²å­˜æª”æ¡ˆ
    await workbook.xlsx.writeFile(filename);
    return filename;
}
```

### Python + openpyxl ç¯„ä¾‹

```python
from openpyxl import Workbook
from datetime import datetime

def generate_orders_excel(orders, filename='è¨‚å–®åŒ¯å…¥.xlsx'):
    wb = Workbook()
    ws = wb.active
    ws.title = 'è¨‚å–®è³‡æ–™'
    
    # è¨­å®šæ¨™é¡Œåˆ—
    headers = [
        'è¨‚å–®ç·¨è™Ÿ', 'å§“å', 'é›»è©±', 'ç·¨è™Ÿ', 'é¡å‹', 'æ—¥æœŸ', 'æ™‚é–“',
        'ä¸Šè»Šå€', 'ä¸Šè»Šåœ°å€', 'ä¸‹è»Šå€', 'ä¸‹è»Šåœ°å€', 'å‚™è¨»', 'éšŠå“¡ç·¨è™Ÿ', 'ç‰¹æ®Šç‹€æ…‹'
    ]
    
    for col, header in enumerate(headers, 1):
        ws.cell(row=1, column=col, value=header)
    
    # æ–°å¢è³‡æ–™åˆ—
    for row_idx, order in enumerate(orders, 2):
        data = [
            order.get('order_code'),           # A æ¬„ row[0]
            order.get('name'),                 # B æ¬„ row[1]
            order.get('phone'),                # C æ¬„ row[2]
            order.get('unit_number'),          # D æ¬„ row[3]
            order.get('type'),                 # E æ¬„ row[4]
            order.get('date'),                 # F æ¬„ row[5] - YYYY-MM-DD
            order.get('time', '')[:5],         # G æ¬„ row[6] - HH:MM
            order.get('origin_area'),          # H æ¬„ row[7]
            order.get('origin_address'),       # I æ¬„ row[8]
            order.get('dest_area'),            # J æ¬„ row[9]
            order.get('dest_address'),         # K æ¬„ row[10]
            order.get('remark', ''),           # L æ¬„ row[11]
            order.get('assigned_user_id', ''), # M æ¬„ row[12]
            order.get('special_status', '')    # N æ¬„ row[13]
        ]
        
        for col_idx, value in enumerate(data, 1):
            ws.cell(row=row_idx, column=col_idx, value=value)
    
    wb.save(filename)
    return filename

# ä½¿ç”¨ç¯„ä¾‹
orders = [{
    'order_code': 'ORD20250824001',
    'name': 'ç‹å°æ˜',
    'phone': '0912345678',
    'unit_number': 'A001',
    'type': 'æ–°åŒ—é•·ç…§',
    'date': '2025-08-24',
    'time': '14:30',
    'origin_area': 'æ¿æ©‹å€',
    'origin_address': 'æ°‘æ—è·¯100è™Ÿ',
    'dest_area': 'æ–°èŠå€',
    'dest_address': 'ä¸­æ­£è·¯200è™Ÿ',
    'remark': 'è¼ªæ¤…ä¹˜å®¢',
    'assigned_user_id': '',     # ç©ºå€¼ = å¾…æ¶å–®ç‹€æ…‹
    'special_status': 'å„ªå…ˆ'
}]

filename = generate_orders_excel(orders)
print(f'Excel æª”æ¡ˆå·²ç”Ÿæˆï¼š{filename}')
```

---

## ğŸ§ª è³‡æ–™é©—è­‰æ¸¬è©¦

### å¿…å¡«æ¬„ä½æ¸¬è©¦

```php
// æ¸¬è©¦å¿…å¡«æ¬„ä½
$testCases = [
    'order_code' => ['', 'ORD001'],      // ç©ºå€¼æœƒå¤±æ•—
    'name' => ['', 'ç‹å°æ˜'],            // ç©ºå€¼æœƒå¤±æ•—
    'phone' => ['', '0912345678'],       // ç©ºå€¼æœƒå¤±æ•—
    'unit_number' => ['', 'A001'],       // ç©ºå€¼æœƒå¤±æ•—
    'type' => ['', 'æ–°åŒ—é•·ç…§'],          // ç©ºå€¼æœƒå¤±æ•—
    'date' => ['', '2025-08-24'],        // ç©ºå€¼æœƒå¤±æ•—
    'time' => ['', '14:30'],             // ç©ºå€¼æœƒå¤±æ•—
    'origin_area' => ['', 'æ¿æ©‹å€'],     // ç©ºå€¼æœƒå¤±æ•—
    'origin_address' => ['', 'æ°‘æ—è·¯'],  // ç©ºå€¼æœƒå¤±æ•—
    'dest_area' => ['', 'æ–°èŠå€'],       // ç©ºå€¼æœƒå¤±æ•—
    'dest_address' => ['', 'ä¸­æ­£è·¯'],    // ç©ºå€¼æœƒå¤±æ•—
];
```

### é¸å¡«æ¬„ä½æ¸¬è©¦

```php
// æ¸¬è©¦é¸å¡«æ¬„ä½
$optionalFields = [
    'remark' => ['', 'è¼ªæ¤…ä¹˜å®¢', null],           // å…è¨±ç©ºå€¼
    'assigned_user_id' => ['', 'D001', null],    // å…è¨±ç©ºå€¼
    'special_status' => ['', 'å„ªå…ˆ', null]        // å…è¨±ç©ºå€¼
];
```

---

## âš ï¸ å¸¸è¦‹éŒ¯èª¤èˆ‡è§£æ±ºæ–¹æ¡ˆ

### 1. è¨‚å–®ç·¨è™Ÿé‡è¤‡éŒ¯èª¤

**éŒ¯èª¤è¨Šæ¯**ï¼š`The order code has already been taken.`

**è§£æ±ºæ–¹æ¡ˆ**ï¼š
- ç¢ºä¿ `order_code` æ¬„ä½åœ¨è³‡æ–™åº«ä¸­å”¯ä¸€
- åŒ¯å…¥å‰æª¢æŸ¥æ˜¯å¦å·²å­˜åœ¨ç›¸åŒç·¨è™Ÿ

```php
// æª¢æŸ¥é‡è¤‡é‚è¼¯
$existingCodes = Order::pluck('order_code')->toArray();
foreach ($orders as $order) {
    if (in_array($order['order_code'], $existingCodes)) {
        // è™•ç†é‡è¤‡å•é¡Œ
    }
}
```

### 2. æ—¥æœŸæ ¼å¼éŒ¯èª¤

**éŒ¯èª¤è¨Šæ¯**ï¼š`The date does not match the format Y-m-d.`

**è§£æ±ºæ–¹æ¡ˆ**ï¼š
- ç¢ºä¿æ—¥æœŸæ ¼å¼ç‚º YYYY-MM-DD
- æˆ–ä½¿ç”¨ Excel æ•¸å­—æ—¥æœŸæ ¼å¼

```php
// å®‰å…¨çš„æ—¥æœŸæ ¼å¼åŒ–
function safeDateFormat($date) {
    if (is_numeric($date)) {
        return \PhpOffice\PhpSpreadsheet\Shared\Date::excelToDateTimeObject($date)->format('Y-m-d');
    }
    return date('Y-m-d', strtotime($date));
}
```

### 3. æ™‚é–“æ ¼å¼éŒ¯èª¤

**å¸¸è¦‹å•é¡Œ**ï¼šæ™‚é–“æ ¼å¼ä¸ä¸€è‡´

**è§£æ±ºæ–¹æ¡ˆ**ï¼š
- çµ±ä¸€ä½¿ç”¨ HH:MM æ ¼å¼
- é¿å…ä½¿ç”¨ AM/PM æ ¼å¼

```php
// æ™‚é–“æ ¼å¼æ¨™æº–åŒ–
function standardizeTime($time) {
    return date('H:i', strtotime($time));
}
```

---

## ğŸ“Š æ•ˆèƒ½æœ€ä½³åŒ–å»ºè­°

### 1. å¤§æ‰¹é‡åŒ¯å…¥

```php
// ä½¿ç”¨æ‰¹æ¬¡æ’å…¥æå‡æ•ˆèƒ½
DB::transaction(function() use ($validatedData) {
    Order::insert($validatedData); // æ‰¹æ¬¡æ’å…¥
});
```

### 2. è¨˜æ†¶é«”ç®¡ç†

```php
// è™•ç†å¤§æª”æ¡ˆæ™‚åˆ†æ‰¹è™•ç†
$chunkSize = 1000;
$chunks = array_chunk($data, $chunkSize);

foreach ($chunks as $chunk) {
    // è™•ç†æ¯å€‹å€å¡Š
    processOrderChunk($chunk);
}
```

---

## ğŸ” é™¤éŒ¯æŒ‡å—

### 1. å•Ÿç”¨è©³ç´°éŒ¯èª¤è¨˜éŒ„

```php
// åœ¨åŒ¯å…¥å‰å•Ÿç”¨æ—¥èªŒè¨˜éŒ„
Log::info('é–‹å§‹åŒ¯å…¥è¨‚å–®', ['file_size' => $file->getSize()]);

foreach ($data as $index => $row) {
    Log::debug('è™•ç†ç¬¬ ' . ($index + 1) . ' è¡Œ', $row);
}
```

### 2. è³‡æ–™æ ¼å¼æª¢æŸ¥

```php
// æª¢æŸ¥æ¯è¡Œè³‡æ–™æ ¼å¼
foreach ($data as $index => $row) {
    Log::info("ç¬¬ {$index} è¡Œè³‡æ–™:", [
        'count' => count($row),
        'data' => array_slice($row, 0, 14)  // åªè¨˜éŒ„å‰14æ¬„
    ]);
}
```

---

## ğŸ“ ç‰ˆæœ¬ç›¸å®¹æ€§

| ç‰ˆæœ¬ | æ”¯æ´æ¬„ä½æ•¸ | èªªæ˜ |
|------|-----------|------|
| v1.0 | 12 æ¬„ | åŸºç¤ç‰ˆæœ¬ï¼Œä¸å«éšŠå“¡ç·¨è™Ÿå’Œç‰¹æ®Šç‹€æ…‹ |
| v1.1 | 13 æ¬„ | æ–°å¢éšŠå“¡ç·¨è™Ÿæ¬„ä½ |
| v1.2 | 14 æ¬„ | **ç•¶å‰ç‰ˆæœ¬**ï¼Œæ–°å¢ç‰¹æ®Šç‹€æ…‹æ¬„ä½ |

### å‘ä¸‹ç›¸å®¹è™•ç†

```php
// ç³»çµ±æœƒè‡ªå‹•é©æ‡‰ä¸åŒæ¬„ä½æ•¸é‡
$columnCount = count($row);
switch ($columnCount) {
    case 12:
        // èˆŠæ ¼å¼ï¼Œspecial_status è¨­ç‚º null
        $specialStatus = null;
        break;
    case 13:
        // ä¸­æœŸæ ¼å¼ï¼Œspecial_status è¨­ç‚º null
        $specialStatus = null;
        break;
    case 14:
        // æœ€æ–°æ ¼å¼
        $specialStatus = $row[13] ?? null;
        break;
    default:
        // ä¸æ”¯æ´çš„æ ¼å¼
        throw new InvalidArgumentException('ä¸æ”¯æ´çš„æ¬„ä½æ•¸é‡');
}
```

---

## ğŸ“ æŠ€è¡“æ”¯æ´

### é–‹ç™¼ç›¸é—œå•é¡Œ

1. **Excel æ ¼å¼ä¸æ­£ç¢º**: æª¢æŸ¥æ¬„ä½é †åºå’Œè³‡æ–™å‹åˆ¥
2. **åŒ¯å…¥å¤±æ•—**: æŸ¥çœ‹ Laravel æ—¥èªŒæª”æ¡ˆ
3. **è³‡æ–™é©—è­‰éŒ¯èª¤**: åƒè€ƒæœ¬æ–‡ä»¶çš„é©—è­‰è¦å‰‡è¡¨
4. **æ•ˆèƒ½å•é¡Œ**: è€ƒæ…®åˆ†æ‰¹è™•ç†å¤§é‡è³‡æ–™

### è¯ç¹«æ–¹å¼

- **ç³»çµ±ç‰ˆæœ¬**: è¨‚å–®ç®¡ç†ç³»çµ± v2025.08
- **Laravel ç‰ˆæœ¬**: 10.x
- **ç›¸ä¾å¥—ä»¶**: Maatwebsite/Laravel-Excel

---

*æ–‡ä»¶è£½ä½œæ—¥æœŸ: 2025-08-24*  
*é©ç”¨ç³»çµ±ç‰ˆæœ¬: è¨‚å–®ç®¡ç†ç³»çµ± v2025.08*  
*æŠ€è¡“æ–‡ä»¶ç‰ˆæœ¬: v1.0*