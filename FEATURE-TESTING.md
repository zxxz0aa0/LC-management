# 客戶欄位編輯功能測試指南

## 功能概述
本次更新實現了通用的客戶欄位快速編輯功能，允許在訂單頁面直接點擊欄位進行編輯。

## 可編輯欄位
1. **乘客備註** - 文字欄位（最多1000字）
2. **個管師** - 文字欄位（最多255字）
3. **輪椅** - 選擇欄位（是/否/未知）
4. **爬梯機** - 選擇欄位（是/否/未知）
5. **服務單位** - 文字欄位（最多255字）

## 測試步驟

### 1. 進入訂單搜尋頁面
- 導航至 `/orders` 路由
- 搜尋任意客戶（例如：輸入客戶名稱或ID）
- 單個客戶結果應顯示客戶詳細資訊卡片

### 2. 編輯文字欄位（備註/個管師/服務單位）
- **點擊欄位**：直接點擊欄位文字（帶下劃線、可點擊的樣式）
- **查看 Modal**：應出現編輯欄位 Modal
- **輸入新值**：在文字框中輸入或修改內容
- **儲存**：點擊「儲存」按鈕
- **驗證**：頁面上的欄位應立即更新

### 3. 編輯選擇欄位（輪椅/爬梯機）
- **點擊欄位**：直接點擊欄位文字
- **查看 Modal**：應出現編輯欄位 Modal（含下拉選單）
- **選擇值**：從下拉選單選擇「是」、「否」或「未知」
- **儲存**：點擊「儲存」按鈕
- **驗證**：頁面上的欄位應立即更新

### 4. 特殊情況測試
- **空值**：輸入空值時，應顯示「無備註」或「無」
- **最大長度**：嘗試超過字數限制時，應無法輸入
- **驗證失敗**：嘗試輸入無效的選擇值（選擇欄位）應顯示驗證錯誤
- **取消編輯**：點擊「取消」按鈕應關閉 Modal，不保存任何改動

## 預期結果

✅ **成功情況：**
- Modal 正確顯示欄位名稱和目前值
- 文字輸入和選擇操作正常
- AJAX 請求成功返回
- 頁面欄位值立即更新
- 顯示成功訊息：「[欄位名稱]已更新」
- Modal 自動關閉

❌ **錯誤情況：**
- 驗證失敗時顯示錯誤訊息
- 網路錯誤時顯示友好的錯誤提示

## 技術細節

### 涉及檔案
1. `resources/views/orders/components/edit-field-modal.blade.php` - 通用 Modal 元件
2. `resources/views/orders/components/customer-search.blade.php` - 編輯欄位標記和 JavaScript 邏輯
3. `app/Http/Controllers/CustomerController.php` - `updateField()` 方法
4. `routes/web.php` - 新增路由

### API 端點
- **路由名稱**：`customers.updateField`
- **請求方式**：`PATCH /customers/{customer}/field`
- **請求體**：
  ```json
  {
    "field_name": "note",
    "value": "編輯的內容"
  }
  ```
- **響應**：
  ```json
  {
    "success": true,
    "message": "欄位已更新",
    "value": "更新後的值"
  }
  ```

## 瀏覽器開發者工具檢查

### 檢查 AJAX 請求
1. 開啟 DevTools (F12)
2. 進入 Network 標籤
3. 編輯任何欄位並儲存
4. 應看到 `PATCH` 請求到 `/customers/{id}/field`
5. 檢查回應狀態應為 200（成功）

### 檢查控制台訊息
- 成功時應無錯誤訊息
- 失敗時應在控制台顯示詳細錯誤信息

## 常見問題排除

### Q: Modal 不出現？
- A: 確認 Bootstrap Modal 已正確載入
- A: 檢查瀏覽器控制台是否有 JavaScript 錯誤

### Q: 編輯後欄位沒有更新？
- A: 檢查 AJAX 請求是否成功（查看 Network 標籤）
- A: 確認後端驗證規則是否正確

### Q: 出現「不允許更新該欄位」錯誤？
- A: 確認欄位名稱在 Controller 的 `$allowedFields` 清單中
- A: 檢查 HTML 中的 `data-field` 屬性是否正確

### Q: CSRF 令牌錯誤？
- A: 確認 HTML 中有 `<meta name="csrf-token">` 標籤
- A: 檢查 JavaScript 中的 CSRF 令牌取得邏輯

## 回溯測試
請確保以下舊功能仍可正常使用：
- ✅ 訂單管理其他操作不受影響
- ✅ 客戶編輯頁面仍可正常使用
- ✅ 其他使用者介面功能正常
