# 訂單 Excel 匯入格式說明書

## 📋 概述

本說明書詳細說明 LC-management 系統訂單 Excel 匯入功能支援的所有欄位格式、資料驗證規則和範例，幫助使用者正確準備匯入檔案。

### 🔧 系統特點
- **雙格式支援**: 自動檢測「完整格式」和「簡化格式」
- **智能欄位匹配**: 支援中英文欄位名稱自動對照
- **併發安全**: 支援多使用者同時匯入，訂單編號絕不重複
- **記憶體優化**: 大檔案分塊處理，防止系統記憶體不足

---

## 📊 支援的匯入格式

### 1. 完整格式 (Full Format)
包含所有詳細欄位，適用於完整的訂單資料匯入

### 2. 簡化格式 (Simple Format)  
僅包含核心欄位，適用於快速訂單建立

**系統會自動檢測您的 Excel 格式並選擇對應的處理邏輯**

---

## 🏷️ 欄位對照表

### 必填欄位 ⚠️

| 欄位說明 | 支援的欄位名稱 | 資料格式 | 範例 |
|---------|-------------|---------|------|
| **訂單編號** | `order_number`, `order_code`, `訂單編號`, `編號`, `單號` | 文字，唯一值 | `LC20250827001` |
| **客戶姓名** | `customer_name`, `name`, `客戶姓名`, `姓名`, `客戶` | 文字 | `王小明` |
| **客戶電話** | `customer_phone`, `phone`, `tel`, `客戶電話`, `電話`, `聯絡` | 數字或文字 | `0912345678` |
| **用車日期** | `ride_date`, `date`, `用車日期`, `日期` | YYYY-MM-DD | `2025-08-27` |
| **用車時間** | `ride_time`, `time`, `用車時間`, `時間` | HH:MM 或 HH:MM:SS<br/>支援 AM/PM | `05:30`, `05:30:00`,<br/>`05:30:00 AM` |
| **上車地址** | `pickup_address`, `origin_address`, `上車地址`, `起點地址`, `pickup` | 完整地址 | `台北市中正區忠孝東路一段1號` |
| **下車地址** | `dropoff_address`, `destination_address`, `下車地址`, `終點地址`, `dropoff`, `destination`, `dest` | 完整地址 | `新北市板橋區中山路二段168號` |

### 選填欄位 📝

#### 客戶資訊
| 欄位說明 | 支援的欄位名稱 | 資料格式 | 範例 |
|---------|-------------|---------|------|
| **身分證** | `customer_id_number`, `身分證`, `編號`, `unit_number` | 文字 | `A123456789` |
| **身分別** | `identity`, `身分別` | 文字 | `市區-低收` |

#### 訂單基本資訊
| 欄位說明 | 支援的欄位名稱 | 資料格式 | 範例 |
|---------|-------------|---------|------|
| **訂單類型** | `order_type`, `type`, `訂單類型`, `類型` | 文字 | `新北長照` |
| **服務公司** | `service_company`, `company`, `服務公司`, `公司` | 文字 | `太豐交通` |

#### 地址資訊 (簡化格式專用)
| 欄位說明 | 支援的欄位名稱 | 資料格式 | 範例 |
|---------|-------------|---------|------|
| **上車區** | `pickup_district`, `origin_area`, `pickup_area`, `上車區域`, `上車區`, `origin_district` | 區域名稱 | `中正區` |
| **下車區** | `dropoff_district`, `dest_area`, `dropoff_area`, `下車區域`, `下車區`, `dest_district` | 區域名稱 | `板橋區` |

#### 特殊需求
| 欄位說明 | 支援的欄位名稱 | 資料格式 | 範例 |
|---------|-------------|---------|------|
| **輪椅** | `wheelchair`, `輪椅`, `輪椅需求` | `是`/`否` | `是` |
| **爬梯機** | `stair_machine`, `爬梯機`, `爬梯機需求` | `是`/`否` | `否` |
| **陪同人數** | `companions`, `陪同人數`, `陪伴者` | 數字 (0-9) | `1` |

#### 共乘資訊
| 欄位說明 | 支援的欄位名稱 | 資料格式 | 範例 |
|---------|-------------|---------|------|
| **共乘姓名** | `carpool_name`, `共乘姓名`, `共乘者姓名` | 文字 | `李小華` |
| **共乘身分證** | `carpool_id`, `共乘身分證`, `共乘者身分證` | 文字 | `B987654321` |

#### 駕駛資訊
| 欄位說明 | 支援的欄位名稱 | 資料格式 | 範例 |
|---------|-------------|---------|------|
| **駕駛姓名** | `driver_name`, `駕駛姓名`, `司機姓名` | 文字 | `張師傅` |
| **隊員編號** | `driver_fleet_number`, `assigned_user_id`, `隊員編號`, `駕駛隊編` | 文字/數字 | `D001` |
| **車牌號碼** | `driver_plate_number`, `車牌號碼`, `車牌` | 文字 | `ABC-1234` |

#### 其他資訊
| 欄位說明 | 支援的欄位名稱 | 資料格式 | 範例 |
|---------|-------------|---------|------|
| **特殊狀態** | `special_status`, `特殊狀態`, `特殊標記` | 文字 | `VIP客戶` |
| **訂單狀態** | `status`, `訂單狀態`, `狀態` | 中文或英文<br/>支援中文輸入 | `待派遣`, `已指派`,<br/>`open`, `assigned` |
| **備註** | `remark`, `備註`, `註記`, `說明` | 文字 | `需要輪椅通道` |
| **建立者** | `created_by`, `建立人` | 文字 | `管理員` |

---

## ⏰ 時間格式詳細說明

### 支援的時間格式
| 格式類型 | 範例 | 說明 |
|---------|------|------|
| **24小時制 (HH:MM)** | `05:30`, `23:45` | 推薦格式，直接匯入 |
| **24小時制 (HH:MM:SS)** | `05:30:00`, `23:45:30` | 含秒數，系統會自動處理 |
| **12小時制 (AM/PM)** | `05:30:00 AM`, `11:45:00 PM` | 系統會自動轉換為24小時制 |

### 時間轉換規則
- `12:00:00 AM` → `00:00:00` (午夜)
- `12:30:00 PM` → `12:30:00` (中午)
- `05:30:00 AM` → `05:30:00` (清晨)
- `05:30:00 PM` → `17:30:00` (下午)

---

## 📅 日期格式說明

### 支援的日期格式
| 格式 | 範例 | 說明 |
|------|------|------|
| **標準格式** | `2025-08-27` | YYYY-MM-DD，推薦使用 |
| **Excel 日期** | 自動轉換 | Excel 儲存格設為日期格式 |

---

## ✅ 資料驗證規則

### 必填欄位檢查
所有必填欄位都不能為空，否則該筆訂單會跳過匯入並顯示錯誤訊息。

### 訂單編號唯一性
- 系統會檢查訂單編號是否已存在
- 重複的訂單編號會跳過匯入
- 建議使用格式：`LC + 日期 + 流水號`，如：`LC20250827001`

### 電話號碼格式
- 支援台灣手機號碼格式：`09XXXXXXXX`
- 支援市話格式：`02-XXXXXXXX`
- 支援各種分隔符號：`-`, ` `, `()`

### 地址驗證
- 系統會自動解析台灣地址的縣市和區域
- 建議使用完整地址格式，包含縣市區域
- 範例：`台北市中正區忠孝東路一段1號`

---

## 📊 訂單狀態對照表

### 支援的狀態值
| 中文狀態 | 英文值 | 說明 |
|---------|---------|--------|
| **待派遣** | `open` | 訂單已建立，等待指派駕駛 |
| **已指派** | `assigned` | 已指派給特定駕駛 |
| **已候補** | `bkorder` | 候補訂單 |
| **黑名單** | `blocked` | 被封鎖的訂單 |
| **已取消** | `cancelled` | 一般取消 |
| **一般取消** | `cancelled` | 一般取消 (同上) |
| **別家有車** | `cancelledOOC` | 別家有車取消 |
| **!取消** | `cancelledNOC` | !取消 |
| **X取消** | `cancelledCOTD` | X取消 |

### 使用說明
- 可以使用**中文**或**英文**輸入狀態
- 系統會自動識別並轉換為正確的資料庫值
- 建議使用中文狀態提升可讀性

---

## 📄 Excel 檔案準備指南

### 檔案格式要求
- **支援格式**: `.xlsx`, `.xls`
- **編碼**: UTF-8 (避免中文亂碼)
- **第一列**: 必須為欄位標題
- **資料列**: 從第二列開始

### 建議的 Excel 結構
```
A列: 訂單編號    B列: 客戶姓名    C列: 客戶電話    D列: 用車日期    ...
LC20250827001   王小明         0912345678     2025-08-27     ...
LC20250827002   李小華         0987654321     2025-08-27     ...
```

### Excel 設定建議
1. **日期欄位**: 設定為 Excel 日期格式
2. **時間欄位**: 設定為時間格式或文字格式
3. **數字欄位**: 電話號碼建議設為文字格式避免科學記號

---

## 🔍 完整格式範例檔案

### 範例 1: 基本訂單
| 訂單編號 | 客戶姓名 | 客戶電話 | 用車日期 | 用車時間 | 上車地址 | 下車地址 | 訂單狀態 | 備註 |
|---------|---------|---------|---------|---------|---------|---------|---------|------|
| LC20250827001 | 王小明 | 0912345678 | 2025-08-27 | 08:30 | 台北市中正區忠孝東路一段1號 | 台北市大安區信義路四段1號 | 待派遣 | 需要輪椅 |

### 範例 2: 含駕駛指派
| 訂單編號 | 客戶姓名 | 客戶電話 | 用車日期 | 用車時間 | 上車地址 | 下車地址 | 駕駛姓名 | 隊員編號 | 車牌號碼 | 訂單狀態 |
|---------|---------|---------|---------|---------|---------|---------|---------|---------|---------|--------|
| LC20250827002 | 李小華 | 0987654321 | 2025-08-27 | 09:00:00 AM | 新北市板橋區中山路二段168號 | 台北市信義區松高路1號 | 張師傅 | D001 | ABC-1234 | 已指派 |

---

## 🚀 簡化格式範例檔案

### 範例 1: 簡化區域格式
| 訂單編號 | 姓名 | 電話 | 用車日期 | 時間 | 上車區 | 下車區 | 上車地址 | 下車地址 |
|---------|------|------|---------|------|-------|-------|---------|---------|
| LC20250827003 | 陳大明 | 0911111111 | 2025-08-27 | 10:30 | 中正區 | 信義區 | 忠孝東路一段1號 | 信義路五段7號 |

---

## ⚠️ 常見錯誤與解決方案

### 1. 時間格式錯誤
**錯誤訊息**: `時間格式錯誤：05:30:00`
**原因**: 系統無法解析時間格式
**解決方案**: 
- 檢查時間格式是否為 `HH:MM` 或 `HH:MM:SS`
- AM/PM 格式請確保包含空格：`05:30:00 AM`

### 2. 訂單編號重複
**錯誤訊息**: `訂單編號 LC20250827001 已存在`
**解決方案**: 
- 檢查資料庫是否已有相同編號
- 使用唯一的訂單編號

### 3. 必填欄位缺失
**錯誤訊息**: `第 X 列：客戶姓名 為必填欄位`
**解決方案**: 
- 確保所有必填欄位都有資料
- 檢查欄位標題是否正確

### 4. 日期格式錯誤
**錯誤訊息**: `日期格式錯誤：2025/8/27`
**解決方案**: 
- 使用標準格式：`2025-08-27`
- 在 Excel 中設定欄位為日期格式

### 5. 訂單狀態錯誤
**錯誤訊息**: `訂單狀態: 無效值 'pending'`
**解決方案**: 
- 使用正確的中文狀態：`待派遣`、`已指派`、`已候補`、`黑名單`、`已取消`、`一般取消`、`別家有車`、`!取消`、`X取消`
- 或使用英文狀態：`open`、`assigned`、`bkorder`、`blocked`、`cancelled`、`cancelledOOC`、`cancelledNOC`、`cancelledCOTD`

---

## 🔧 匯入流程說明

### 1. 檔案上傳
1. 選擇符合格式的 Excel 檔案
2. 系統會自動檢測格式類型
3. 顯示檔案資訊和預估處理時間

### 2. 資料驗證
1. 檢查欄位標題是否正確
2. 驗證必填欄位完整性
3. 檢查資料格式規範

### 3. 匯入處理
1. 分批次處理避免記憶體不足
2. 即時顯示進度和統計
3. 併發安全處理多使用者操作

### 4. 結果報告
1. 顯示成功匯入數量
2. 列出所有錯誤詳情
3. 提供修正建議

---

## 📞 技術支援

### 記錄查看
匯入過程的詳細記錄儲存於：
- **一般記錄**: `storage/logs/import.log`
- **系統記錄**: `storage/logs/laravel.log`

### 偵錯模式
如需要詳細的除錯資訊，請聯繫系統管理員啟用 `import_debug_log` 設定。

### 效能建議
- **小檔案** (< 1000筆): 可直接匯入
- **中檔案** (1000-5000筆): 分時段匯入較佳
- **大檔案** (> 5000筆): 建議分割多個檔案匯入

---

## 📋 範本下載

系統建議您使用以下標題建立 Excel 檔案：

### 完整格式範本標題
```
訂單編號 | 客戶姓名 | 客戶電話 | 用車日期 | 用車時間 | 上車地址 | 下車地址 | 身分證 | 身分別 | 訂單類型 | 服務公司 | 輪椅 | 爬梯機 | 陪同人數 | 共乘姓名 | 共乘身分證 | 駕駛姓名 | 隊員編號 | 車牌號碼 | 訂單狀態 | 特殊狀態 | 備註
```

### 簡化格式範本標題  
```
訂單編號 | 姓名 | 電話 | 用車日期 | 時間 | 上車區 | 下車區 | 上車地址 | 下車地址 | 隊員編號 | 訂單狀態
```

---

**文件版本**: v1.0  
**更新日期**: 2025-08-27  
**適用系統**: LC-management v1.0+

> 💡 **提示**: 建議首次使用時先用少量測試資料進行匯入，確認格式正確後再進行大批量匯入。