# 訂單管理系統 - EXCEL 匯入格式規格說明

## 📋 文件概述

本文件提供完整的 EXCEL 檔案格式說明，供外部系統匯出訂單資料時參考。確保匯出的檔案能夠被本訂單管理系統正確匯入。

---

## 🎯 基本格式要求

### 檔案格式
- **檔案類型**: `.xlsx` (Excel 2007 或更新版本)
- **編碼**: UTF-8
- **工作表**: 使用第一個工作表的資料

### 資料結構
- **標題列**: 第1行為標題列（系統會自動跳過）
- **資料列**: 從第2行開始為實際訂單資料
- **欄位數量**: 支援12-14個欄位（向下相容）

---

## 📊 完整欄位規格 (14欄位標準格式)

| 欄位順序 | 欄位名稱 | 資料型別 | 必填 | 格式要求 | 範例 | 說明 |
|---------|---------|---------|------|---------|------|------|
| **A (第1欄)** | 訂單編號 | 文字 | ✅ | 不可重複 | `ORD20250824001` | 系統唯一識別碼 |
| **B (第2欄)** | 姓名 | 文字 | ✅ | 不可空白 | `王小明` | 乘客姓名 |
| **C (第3欄)** | 電話 | 文字 | ✅ | 不可空白 | `0912345678` | 聯絡電話 |
| **D (第4欄)** | 編號 | 文字 | ✅ | 不可空白 | `A001` | 內部編號或案號 |
| **E (第5欄)** | 類型 | 文字 | ✅ | 不可空白 | `新北長照` | 訂單類型分類 |
| **F (第6欄)** | 日期 | 日期 | ✅ | 見日期格式說明 | `2025-08-24` | 車趟日期 |
| **G (第7欄)** | 時間 | 時間 | ✅ | HH:MM 或 HH:MM:SS | `14:30` | 車趟時間 |
| **H (第8欄)** | 上車區 | 文字 | ✅ | 不可空白 | `板橋區` | 上車區域 |
| **I (第9欄)** | 上車地址 | 文字 | ✅ | 不可空白 | `民族路100號` | 詳細上車地址 |
| **J (第10欄)** | 下車區 | 文字 | ✅ | 不可空白 | `新莊區` | 下車區域 |
| **K (第11欄)** | 下車地址 | 文字 | ✅ | 不可空白 | `中正路200號` | 詳細下車地址 |
| **L (第12欄)** | 備註 | 文字 | ❌ | 可空白 | `輪椅乘客` | 額外說明 |
| **M (第13欄)** | 隊員編號 | 文字 | ❌ | 可空白 | `D001` | 駕駛員編號 |
| **N (第14欄)** | 特殊狀態 | 文字 | ❌ | 可空白 | `優先` | 特殊標記 |

---

## 📅 日期格式支援

系統支援多種日期格式，會自動識別並轉換：

### ✅ 支援的格式
```
1. Excel 數字格式: 45516 (會自動轉換為日期)
2. ISO 格式: 2025-08-24
3. 斜線格式: 2025/08/24
4. 點號格式: 2025.08.24
5. 中文格式: 2025年8月24日
```

### ❌ 不支援的格式
```
- 純文字描述: "明天"、"下週五"
- 模糊格式: "8月底"
- 錯誤分隔符: "2025_08_24"
```

---

## 🕐 時間格式說明

### ✅ 支援的時間格式
```
- 標準格式: 14:30
- 完整格式: 14:30:00
- 12小時制: 2:30 PM (會自動轉換)
```

### ❌ 不支援的時間格式
```
- 模糊時間: "下午"、"晚上"
- 錯誤格式: "14時30分"
```

---

## 🚨 重要注意事項

### 1. **資料完整性**
- 所有 ✅ 標記的欄位都是必填，不可空白
- 訂單編號必須唯一，重複的編號會導致匯入失敗

### 2. **狀態自動判定**
- 如果「隊員編號」有值 → 訂單狀態自動設為 `已指派`
- 如果「隊員編號」空白 → 訂單狀態自動設為 `待搶單`

### 3. **向下相容性**
```
✅ 14欄位: 完整功能（推薦）
✅ 13欄位: 不含特殊狀態欄位
✅ 12欄位: 不含隊員編號和特殊狀態欄位
```

### 4. **檔案大小限制**
- 建議單次匯入不超過 1000 筆訂單
- 檔案大小建議在 10MB 以內

---

## 📝 標準 EXCEL 範例格式

```
| A          | B      | C          | D    | E      | F          | G     | H      | I          | J      | K          | L      | M    | N    |
|------------|--------|------------|------|--------|------------|-------|--------|------------|--------|------------|--------|------|------|
| 訂單編號    | 姓名   | 電話       | 編號 | 類型   | 日期       | 時間  | 上車區 | 上車地址   | 下車區 | 下車地址   | 備註   |隊員編號|特殊狀態|
| ORD001     | 王小明 | 0912345678 | A001 | 新北長照| 2025-08-24 | 14:30 | 板橋區 | 民族路100號| 新莊區 | 中正路200號| 輪椅乘客|     |      |
| ORD002     | 李小華 | 0923456789 | A002 | 新北長照| 2025-08-24 | 15:00 | 三重區 | 重新路50號 | 蘆洲區 | 中山路300號|       | D001 |      |
```

---

## 🔧 程式實作建議

### 1. **匯出時的欄位對應**
```php
// PHP 範例
$excelData = [
    $order->order_code,        // A: 訂單編號
    $order->name,              // B: 姓名
    $order->phone,             // C: 電話
    $order->unit_number,       // D: 編號
    $order->type,              // E: 類型
    $order->date,              // F: 日期 (Y-m-d 格式)
    $order->time,              // G: 時間 (H:i:s 格式)
    $order->origin_area,       // H: 上車區
    $order->origin_address,    // I: 上車地址
    $order->dest_area,         // J: 下車區
    $order->dest_address,      // K: 下車地址
    $order->remark ?? '',      // L: 備註
    $order->assigned_user_id ?? '', // M: 隊員編號
    $order->special_status ?? ''    // N: 特殊狀態
];
```

### 2. **日期時間處理**
```javascript
// JavaScript 範例
function formatDateForExcel(date) {
    // 確保輸出 YYYY-MM-DD 格式
    return date.toISOString().split('T')[0];
}

function formatTimeForExcel(time) {
    // 確保輸出 HH:MM 格式
    return time.substr(0, 5);
}
```

### 3. **資料驗證**
```python
# Python 範例
def validate_order_data(row):
    required_fields = [
        'order_code', 'name', 'phone', 'unit_number', 
        'type', 'date', 'time', 'origin_area', 
        'origin_address', 'dest_area', 'dest_address'
    ]
    
    for field in required_fields:
        if not row.get(field) or str(row[field]).strip() == '':
            return False, f"欄位 {field} 不可空白"
    
    return True, "驗證通過"
```

---

## ❌ 常見匯入錯誤

### 1. **欄位錯誤**
```
❌ 錯誤: 訂單編號重複
解決: 確保每個訂單編號在系統中唯一

❌ 錯誤: 必填欄位空白
解決: 檢查前11個欄位是否都有值

❌ 錯誤: 日期格式不正確
解決: 使用 YYYY-MM-DD 標準格式
```

### 2. **格式錯誤**
```
❌ 錯誤: 上傳 .xls 檔案
解決: 請存為 .xlsx 格式

❌ 錯誤: 檔案編碼問題導致亂碼
解決: 確保檔案使用 UTF-8 編碼
```

### 3. **資料邏輯錯誤**
```
❌ 錯誤: 車趟時間早於當前時間
提示: 系統會接受，但建議檢查邏輯正確性

❌ 錯誤: 隊員編號不存在
提示: 系統會接受，但該駕駛員可能無法看到訂單
```

---

## 📞 技術支援

如果在匯入過程中遇到問題：

1. **檢查格式**: 按照本文件檢查 EXCEL 格式是否正確
2. **測試小批量**: 先用少量資料測試匯入功能
3. **查看錯誤訊息**: 系統會顯示詳細的錯誤資訊和位置

---

## 📖 版本記錄

| 版本 | 日期 | 更新內容 |
|------|------|----------|
| v1.0 | 2025-08-24 | 初版：基於系統代碼分析製作 |

---

**⚠️ 重要提醒**: 
- 本格式說明基於訂單管理系統 v2025.08 版本
- 匯入前請先進行小批量測試
- 建議保留原始資料備份

---
*文件製作日期: 2025-08-24*  
*適用系統版本: 訂單管理系統 v2025.08*